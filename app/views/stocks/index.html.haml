%h2 Dividend Reporter
%br/
%h3 Active Stocks Master List

%table.stocks
  %thead
    %tr
      - if user_signed_in?
        %th Watch
      %th Symbol
      %th Company Name
      %th Price
      %th Dividend/Share
      %th Yield
      %th ExDate
      %th.last Pay Date
  %tbody
    - @stocks.each do |s|
      %tr{ :class => cycle("odd","even") }
        - if current_user && current_user.user_stock_watches.find_by_stock_id(s.id)
          %td
            = link_to 'unwatch', user_remove_watch_path(s)
          %td
            = s.try(:symbol)
          %td
            = link_to s.try(:company_name), stock_path(s)
          %td
            = s.quotes.last.try(:last_price)
          %td
            = s.quotes.last.try(:dividends_per_share)
          %td
            = s.quotes.last.try(:dividend_yield)
          %td
            = s.quotes.last.try(:ex_dividend_date)
          %td.last
            = s.quotes.last.try(:dividend_pay_date)
        - else
          - if user_signed_in?
            %td
              = link_to 'watch'
          %td
            = s.try(:symbol)
          %td
            = link_to s.try(:company_name), stock_path(s)
          %td
            = s.quotes.last.try(:last_price)
          %td
            = s.quotes.last.try(:dividends_per_share)
          %td
            = s.quotes.last.try(:dividend_yield)
          %td
            = s.quotes.last.try(:ex_dividend_date)
          %td.last
            = s.quotes.last.try(:dividend_pay_date)
